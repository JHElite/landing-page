---
import type { HTMLAttributes } from "astro/types";
import { marked } from "marked";
import { propsWithMergedClasses } from "../../helpers/style";

interface Props extends HTMLAttributes<"div"> {
  content: string;
  noMarginY?: boolean;
  noMarginTop?: boolean;
  noMarginBottom?: boolean;
}

const { content, noMarginY, noMarginTop, noMarginBottom, ...divProps } =
  Astro.props;

marked.use({ gfm: true, breaks: true });
---

<div
  set:html={marked.parse(content)}
  {...propsWithMergedClasses(divProps, [
    "markdown",
    {
      "no-margin-y": noMarginY,
      "no-margin-top": noMarginTop,
      "no-margin-bottom": noMarginBottom,
    },
  ])}
/>

<style is:global>
  .markdown {
    @apply prose max-w-full;
    code {
      @apply rounded-md;
    }
    blockquote {
      ::before,
      ::after {
        opacity: 0.66;
      }
    }
    &.no-margin-y > *,
    &.no-margin-top > * {
      &:first-child {
        margin-top: 0;
      }
    }
    &.no-margin-y > *,
    &.no-margin-bottom > * {
      &:last-child {
        margin-bottom: 0;
      }
    }
  }
</style>
